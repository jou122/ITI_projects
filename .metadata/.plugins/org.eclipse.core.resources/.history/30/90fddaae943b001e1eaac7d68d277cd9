/*
 * MSTK_Prog.c
 *
 *  Created on: Aug 15, 2023
 *      Author: user
 */

#include"../../LIB/BIT_Math.h"
#include"../../LIB/STD_Types.h"
#include "MSTK_Int.h"
#include "MSTK_Config.h"
#include "MSTK_Private.h"

void MSTK_vInit(void) {
#if(MSTK_CLOCK_SOURCE==AHB)
	{
		CLR_BIT(MSTK->CTRL,CLKSOURCE);
	}
#elif(MSTK_CLOCK_SOURCE==AHB_BY_8)
	{
		SET_BIT(MSTK->CTRL,CLKSOURCE);
	}
#endif
}

void MSTK_vSetIntState(MSTK_INT_STATE_t Copy_State){
	switch(Copy_State){
		case MSTK_INT_ENABLE:
			SET_BIT(MSTK->CTRL,TICKINT);
			break;
		case MSTK_INT_DISABLE:
			SET_BIT(MSTK->CTRL,TICKINT);
			break;
	}
}

u8  MSTK_u8GetFlag(void){
return GET_BIT(MSTK->CTRL,COUNTFLAG);
}

u32 MSTK_u32GetRemainingTime(void){
	return (MSTK->LOAD - MSTK->VAL);
}

u32 MSTK_u32GetElabsedTime(void){
	return (MSTK->VAL);
}


void MSTK_vStart(u32 Copy_u32Value){
	MSTK->LOAD=Copy_u32Value;
	MSTK->VAL=0;
	SET_BIR(MSTK->CTRL,ENABLE);
}

void MSTK_vDelay_us(u32 Copy_u32ValueUs){
	MSTK_vIntState(MSTK_INT_DISABLE);
	MSTK_vStart(Copy_u32ValueUs);
	while(MSTK_u8GetFlag()==0);
}

void MSTK_vDelay_ms(u32 Copy_u32ValueMs){
	MSTK_vIntState(MSTK_INT_DISABLE);
	MSTK_vStart(Copy_u32ValueMs*1000);
	while(MSTK_u8GetFlag()==0);
}
